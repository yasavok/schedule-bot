# Часто задаваемые вопросы (FAQ)

## Общие вопросы

### Как получить токен бота?

1. Откройте Telegram
2. Найдите [@BotFather](https://t.me/BotFather)
3. Отправьте команду `/newbot`
4. Следуйте инструкциям
5. Скопируйте полученный токен

### Как часто бот проверяет обновления?

По умолчанию каждые 6 часов. Вы можете изменить это в файле `config.py`, изменив значение `CHECK_INTERVAL`.

### Где хранятся данные пользователей?

В файле `database.db` (SQLite база данных) в корне проекта.

### Можно ли использовать JSON вместо SQLite?

Да, но текущая реализация использует SQLite для лучшей производительности. Если хотите JSON, можете модифицировать `database.py`.

## Технические вопросы

### Как бот определяет новое расписание?

Бот скачивает изображение и вычисляет его MD5 хэш. Если хэш отличается от предыдущего - это новое расписание.

### Что делать, если бот не находит расписание?

1. Проверьте доступность сайта: https://lsxt.my1.ru/blog/
2. Запустите тестовый скрипт: `python test_parser.py`
3. Возможно, структура сайта изменилась - нужно обновить логику парсинга в `parser.py`

### Как изменить URL сайта колледжа?

Откройте `config.py` и измените значение `COLLEGE_URL`.

### Бот отправляет старое расписание повторно

Удалите файл `last_schedule_hash.txt` - бот пересчитает хэш при следующей проверке.

### Как добавить поддержку нескольких групп?

Это требует модификации кода:
1. Добавить поле `group` в таблицу `users`
2. Модифицировать парсер для определения группы из расписания
3. Добавить фильтрацию при рассылке

## Проблемы и решения

### Ошибка "Invalid token"

Проверьте токен в файле `.env`. Убедитесь, что:
- Файл `.env` существует
- Токен скопирован полностью
- Нет лишних пробелов

### Ошибка "Module not found"

Установите зависимости:
```bash
pip install -r requirements.txt
```

### Бот не отвечает на команды

1. Проверьте, запущен ли бот: `python bot.py`
2. Проверьте логи в `bot.log`
3. Убедитесь, что бот не заблокирован в Telegram

### База данных заблокирована (database is locked)

Закройте все другие программы, которые могут использовать `database.db`.

### Бот падает при отправке фото

Проверьте:
1. Существует ли файл с расписанием
2. Размер файла (Telegram ограничивает размер до 10 МБ)
3. Формат файла (должен быть JPG или PNG)

## Настройка и оптимизация

### Как уменьшить интервал проверки для тестирования?

В `config.py` измените:
```python
CHECK_INTERVAL = 300  # 5 минут для тестирования
```

Не забудьте вернуть обратно для продакшена!

### Как запустить бот на сервере?

См. раздел "Запуск в фоновом режиме" в `INSTALL.md`.

### Как сделать резервную копию данных?

```bash
# Linux/Mac
tar -czf backup.tar.gz database.db .env schedules/

# Windows
# Просто скопируйте эти файлы в безопасное место
```

### Можно ли запустить несколько ботов?

Да, но каждому нужен свой токен и своя папка с проектом.

## Функциональность

### Как отправить расписание вручную?

Используйте скрипт:
```bash
python manual_send.py путь/к/расписанию.jpg
```

### Как посмотреть список подписчиков?

Откройте базу данных:
```bash
sqlite3 database.db "SELECT * FROM users;"
```

Или используйте команду `/stats` в боте.

### Как удалить пользователя из базы?

```bash
sqlite3 database.db "DELETE FROM users WHERE user_id = 123456789;"
```

Или пользователь может сам отписаться через команду `/unsubscribe`.

### Можно ли добавить уведомления для админа?

Да, добавьте в `scheduler.py` отправку сообщения админу при обнаружении нового расписания:

```python
ADMIN_ID = 123456789  # Ваш Telegram ID

await bot.send_message(
    ADMIN_ID,
    f"✅ Новое расписание отправлено {success_count} пользователям"
)
```

## Безопасность

### Безопасно ли хранить токен в .env?

Да, но:
- Не коммитьте `.env` в git (уже добавлен в `.gitignore`)
- Ограничьте доступ к файлу на сервере
- Регулярно меняйте токен через @BotFather

### Что делать, если токен утек?

1. Откройте [@BotFather](https://t.me/BotFather)
2. Выберите вашего бота
3. Используйте команду `/revoke`
4. Получите новый токен
5. Обновите `.env`

### Как защитить базу данных?

SQLite файл уже защищен правами доступа ОС. На сервере установите:
```bash
chmod 600 database.db
```

## Разработка

### Как добавить новую команду?

1. Добавьте обработчик в `handlers.py`:
```python
async def cmd_mycommand(message: Message):
    await message.answer("Моя команда!")
```

2. Зарегистрируйте в `register_handlers()`:
```python
dp.message.register(cmd_mycommand, Command("mycommand"))
```

### Как изменить логику парсинга?

Отредактируйте метод `parse_schedule_images()` в `parser.py`.

### Как добавить inline кнопки?

См. примеры в `keyboards.py` и `handlers.py`.

## Поддержка

### Где получить помощь?

1. Проверьте эту документацию
2. Посмотрите логи в `bot.log`
3. Запустите `python test_parser.py` для диагностики
4. Создайте issue в репозитории проекта

### Как сообщить об ошибке?

Создайте issue с:
- Описанием проблемы
- Шагами для воспроизведения
- Логами из `bot.log`
- Версией Python и библиотек

### Могу ли я использовать этот код для своего колледжа?

Да! Просто измените `COLLEGE_URL` в `config.py` и адаптируйте парсер под структуру вашего сайта.
